<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de Rapaces</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        button.btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        button.btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }

        .entry-item {
            background: #f0f4f8;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2a5298;
        }

        .entry-item .date {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .entry-item .content {
            color: #333;
        }

        .rapace-card {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 2px solid #e3f2fd;
            position: relative;
        }

        .rapace-card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .rapace-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        .rapace-actions button {
            padding: 8px 12px;
            font-size: 12px;
        }

        .conditional-fields {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f0f4f8;
            border-radius: 8px;
        }

        .conditional-fields.active {
            display: block;
        }

        .rating-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .rating-group input[type="radio"] {
            width: auto;
        }

        .hunt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .hunt-item {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e3f2fd;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .day-card {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #2a5298;
        }

        .day-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4285f4;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            .hunt-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
            <svg width="80" height="80" viewBox="0 0 200 200" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));">
                <circle cx="100" cy="100" r="95" fill="white" stroke="#1e3c72" stroke-width="8"/>
                <g transform="translate(100,100) scale(0.7)">
                    <path d="M-70,-30 Q-50,-70 0,-50 Q50,-70 70,-30 Q60,-50 30,-40 Q15,-65 0,-45 Q-15,-65 -30,-40 Q-60,-50 -70,-30" fill="#1e3c72"/>
                    <circle cx="-30" cy="-30" r="8" fill="white"/>
                    <circle cx="-28" cy="-32" r="5" fill="#1e3c72"/>
                    <circle cx="-26" cy="-34" r="2" fill="white"/>
                    <path d="M-15,-15 Q5,5 15,-15 Q20,-10 10,-8 Q-10,-8 -15,-15" fill="#2a5298"/>
                    <path d="M-50,15 Q-30,30 0,15 Q30,30 50,15 Q40,40 0,35 Q-40,40 -50,15" fill="#1e3c72"/>
                </g>
            </svg>
            <div>
                <h1>ü¶Ö Gestionnaire de Rapaces</h1>
                <p>Version locale - Sauvegarde automatique</p>
            </div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('gestion')">Gestion</button>
        <button class="tab" onclick="showTab('suivi')">Suivi</button>
        <button class="tab" onclick="showTab('chasse')">Chasse</button>
        <button class="tab" onclick="showTab('affaitage')">Affaitage</button>
        <button class="tab" onclick="showTab('stats')">Statistiques</button>
        <button class="tab" onclick="showTab('demo')">D√©mo</button>
    </div>

    <div id="gestion" class="tab-content active">
        <h2>Ajouter un Rapace</h2>
        <div class="form-group">
            <label for="rapace-name">Nom du rapace :</label>
            <input type="text" id="rapace-name" placeholder="Ex: Aigle royal">
        </div>
        <div class="form-group">
            <label for="rapace-species">Esp√®ce :</label>
            <input type="text" id="rapace-species" placeholder="Ex: Aquila chrysaetos">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="rapace-birthdate">Date de naissance :</label>
                <input type="date" id="rapace-birthdate">
            </div>
            <div class="form-group">
                <label for="rapace-sex">Sexe :</label>
                <select id="rapace-sex">
                    <option value="forme">Forme</option>
                    <option value="tiercelet">Tiercelet</option>
                </select>
            </div>
        </div>
        <button onclick="addRapace()">Ajouter le Rapace</button>

        <h2 style="margin-top: 40px;">Mes Rapaces</h2>
        <div id="rapace-list"></div>
    </div>

    <div id="suivi" class="tab-content">
        <h2>Suivi Quotidien</h2>
        <div class="form-group">
            <label for="rapace-select">S√©lectionner un rapace :</label>
            <select id="rapace-select" onchange="updateEntryList()">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-group">
            <label for="event-type">Type d'√©v√©nement :</label>
            <select id="event-type" onchange="showEventFields()">
                <option value="nourriture">Nourriture</option>
                <option value="vol">Vol</option>
                <option value="comportement">Comportement</option>
                <option value="sante">Sant√©</option>
                <option value="entrainement">Entra√Ænement</option>
            </select>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="event-date">Date :</label>
                <input type="date" id="event-date">
            </div>
            <div class="form-group">
                <label for="event-time">Heure :</label>
                <input type="time" id="event-time">
            </div>
        </div>
        
        <div class="form-group">
            <label for="event-notes">Notes :</label>
            <textarea id="event-notes" rows="3" placeholder="Observations..."></textarea>
        </div>

        <!-- Champs conditionnels pour Nourriture -->
        <div id="nourriture-fields" class="conditional-fields active">
            <div class="form-row">
                <div class="form-group">
                    <label for="poids-avant">Poids avant (g) :</label>
                    <input type="number" id="poids-avant" min="0">
                </div>
                <div class="form-group">
                    <label for="poids-apres">Poids apr√®s (g) :</label>
                    <input type="number" id="poids-apres" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="detail-nourriture">Menu :</label>
                    <select id="detail-nourriture">
                        <option value="poussin">Poussin</option>
                        <option value="caille">Caille</option>
                        <option value="pigeon">Pigeon</option>
                        <option value="lapin">Lapin</option>
                        <option value="lievre">Li√®vre</option>
                        <option value="canard">Canard</option>
                        <option value="faisan">Faisan</option>
                        <option value="perdrix">Perdrix</option>
                        <option value="boeuf">B≈ìuf</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quantite-nourriture">Quantit√© :</label>
                    <input type="text" id="quantite-nourriture" placeholder="Ex: 200g">
                </div>
            </div>
        </div>

        <div id="vol-fields" class="conditional-fields">
            <div class="form-group">
                <label for="type-vol">Type de vol :</label>
                <select id="type-vol">
                    <option value="suite">Suit√©</option>
                    <option value="chasse">Chasse</option>
                    <option value="entrainement">Entra√Ænement</option>
                </select>
            </div>
        </div>

        <div id="comportement-fields" class="conditional-fields">
            <div class="form-group">
                <label>R√©activit√© (1-5) :</label>
                <div class="rating-group">
                    <input type="radio" id="react1" name="reactivite" value="1">
                    <label for="react1">1</label>
                    <input type="radio" id="react2" name="reactivite" value="2">
                    <label for="react2">2</label>
                    <input type="radio" id="react3" name="reactivite" value="3">
                    <label for="react3">3</label>
                    <input type="radio" id="react4" name="reactivite" value="4">
                    <label for="react4">4</label>
                    <input type="radio" id="react5" name="reactivite" value="5">
                    <label for="react5">5</label>
                </div>
            </div>
        </div>

        <div id="sante-fields" class="conditional-fields">
            <div class="form-group">
                <label for="etat-sante">√âtat :</label>
                <select id="etat-sante">
                    <option value="ras">RAS</option>
                    <option value="pb">PB</option>
                </select>
            </div>
        </div>

        <div id="entrainement-fields" class="conditional-fields">
            <div class="form-group">
                <label for="type-entrainement">Type d'entra√Ænement :</label>
                <select id="type-entrainement">
                    <option value="filiere">Fili√®re</option>
                    <option value="charriot">Charriot</option>
                    <option value="rc-voiture">RC Voiture</option>
                    <option value="drone">Drone</option>
                    <option value="vivant">Vivant</option>
                    <option value="corde">Corde</option>
                    <option value="ascendant">Ascendant</option>
                </select>
            </div>
        </div>

        <button onclick="addEntry()">Ajouter l'Entr√©e</button>

        <h2 style="margin-top: 40px;">Historique R√©cent</h2>
        <div id="entry-list"></div>
    </div>

    <div id="chasse" class="tab-content">
        <h2>Registre de Chasse</h2>
        <div class="form-group">
            <label for="chasse-rapace">Rapace :</label>
            <select id="chasse-rapace">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="chasse-date">Date :</label>
                <input type="date" id="chasse-date">
            </div>
            <div class="form-group">
                <label for="chasse-time">Heure :</label>
                <input type="time" id="chasse-time">
            </div>
        </div>
        
        <div class="hunt-grid">
            <div class="hunt-item">
                <label for="chasse-faisan">Faisan :</label>
                <input type="number" id="chasse-faisan" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-perdrix">Perdrix :</label>
                <input type="number" id="chasse-perdrix" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-lapin">Lapin :</label>
                <input type="number" id="chasse-lapin" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-lievre">Li√®vre :</label>
                <input type="number" id="chasse-lievre" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-canard">Canard :</label>
                <input type="number" id="chasse-canard" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-oie">Oie :</label>
                <input type="number" id="chasse-oie" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-autre">Autre :</label>
                <input type="number" id="chasse-autre" min="0" max="10" value="0">
            </div>
        </div>
        
        <div class="form-group">
            <label for="chasse-notes">Notes :</label>
            <textarea id="chasse-notes" rows="3" placeholder="Observations sur la chasse..."></textarea>
        </div>
        
        <button onclick="addChasse()">Enregistrer la Chasse</button>
        
        <h2 style="margin-top: 40px;">Historique des Chasses</h2>
        <div id="chasse-list"></div>
    </div>

    <div id="affaitage" class="tab-content">
        <h2>Affaitage</h2>
        <div class="form-group">
            <label for="affaitage-rapace">Rapace :</label>
            <select id="affaitage-rapace">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="affaitage-date">Date :</label>
                <input type="date" id="affaitage-date">
            </div>
            <div class="form-group">
                <label for="affaitage-time">Heure :</label>
                <input type="time" id="affaitage-time">
            </div>
        </div>
        
        <div class="form-group">
            <label>Activit√©s :</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="prise-nourriture">
                    <label for="prise-nourriture">Prise de nourriture</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="gant">
                    <label for="gant">Gant</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filiere">
                    <label for="filiere">Fili√®re</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="libre">
                    <label for="libre">Libre</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="affaitage-notes">Notes :</label>
            <textarea id="affaitage-notes" rows="3" placeholder="Observations sur l'affaitage..."></textarea>
        </div>
        
        <button onclick="addAffaitage()">Enregistrer l'Affaitage</button>
        
        <h2 style="margin-top: 40px;">Historique d'Affaitage</h2>
        <div id="affaitage-list"></div>
    </div>

    <div id="stats" class="tab-content">
        <h2>Statistiques</h2>
        <div style="margin-bottom: 20px;">
            <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                <input type="date" id="stats-date" onchange="updateStats()">
                <button onclick="showTodayStats()">Aujourd'hui</button>
            </div>
        </div>
        <div id="stats-content"></div>
    </div>

    <div id="demo" class="tab-content">
        <h2>üéØ D√©monstration</h2>
        
        <div class="day-card" style="background: #e8f5e8;">
            <h4>‚ú® Test rapide de l'application</h4>
            <p>Utilisez cette section pour tester rapidement les fonctionnalit√©s</p>
        </div>
        
        <h3>‚ûï Ajouter un rapace de test</h3>
        <div class="form-group">
            <label for="demo-name">Nom du rapace :</label>
            <input type="text" id="demo-name" value="Faucon p√®lerin">
        </div>
        <div class="form-group">
            <label for="demo-species">Esp√®ce :</label>
            <input type="text" id="demo-species" value="Falco peregrinus">
        </div>
        <button onclick="addDemoRapace()">‚ûï Ajouter rapace de d√©mo</button>

        <h3 style="margin-top: 30px;">üé≤ G√©n√©rer des donn√©es de test</h3>
        <p>Cr√©ez automatiquement plusieurs rapaces avec des donn√©es d'exemple</p>
        <button onclick="generateDemoData()">üé≤ G√©n√©rer donn√©es compl√®tes</button>
        <button onclick="clearAllDemoData()" class="btn-danger" style="margin-left: 10px;">üóëÔ∏è Vider toutes les donn√©es</button>

        <h3 style="margin-top: 30px;">üìä √âtat actuel des donn√©es</h3>
        <div id="demo-data" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px;">
            Chargement des donn√©es...
        </div>

        <div style="margin-top: 20px;">
            <button onclick="showCurrentData()">üîç Actualiser l'affichage</button>
        </div>
    </div>
</div>

<!-- Modal pour √©dition -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>Modifier le Rapace</h2>
        <div class="form-group">
            <label for="edit-name">Nom :</label>
            <input type="text" id="edit-name">
        </div>
        <div class="form-group">
            <label for="edit-species">Esp√®ce :</label>
            <input type="text" id="edit-species">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="edit-birthdate">Date de naissance :</label>
                <input type="date" id="edit-birthdate">
            </div>
            <div class="form-group">
                <label for="edit-sex">Sexe :</label>
                <select id="edit-sex">
                    <option value="forme">Forme</option>
                    <option value="tiercelet">Tiercelet</option>
                </select>
            </div>
        </div>
        <button onclick="saveEdit()">Sauvegarder</button>
        <button onclick="closeEditModal()" style="margin-left: 10px;">Annuler</button>
    </div>
</div>

<script>
// Variables globales
let rapaces = [];
let entries = [];
let chasses = [];
let affaitages = [];
let currentEditId = null;

// Initialisation
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    updateRapaceSelects();
    updateRapaceList();
    updateEntryList();
    updateChasseList();
    updateAffaitageList();
    showCurrentData();
    
    // D√©finir les dates par d√©faut
    const today = new Date();
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(input => {
        if (input.id !== 'rapace-birthdate' && input.id !== 'edit-birthdate') {
            input.value = today.toISOString().split('T')[0];
        }
    });
    
    // D√©finir l'heure par d√©faut
    const timeInputs = document.querySelectorAll('input[type="time"]');
    timeInputs.forEach(input => {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        input.value = `${hours}:${minutes}`;
    });
});

// Gestion des donn√©es
function loadData() {
    try {
        const savedRapaces = localStorage.getItem('rapaces');
        const savedEntries = localStorage.getItem('entries');
        const savedChasses = localStorage.getItem('chasses');
        const savedAffaitages = localStorage.getItem('affaitages');
        
        if (savedRapaces) rapaces = JSON.parse(savedRapaces);
        if (savedEntries) entries = JSON.parse(savedEntries);
        if (savedChasses) chasses = JSON.parse(savedChasses);
        if (savedAffaitages) affaitages = JSON.parse(savedAffaitages);
    } catch (error) {
        console.error('Erreur lors du chargement des donn√©es:', error);
        showNotification('Erreur lors du chargement des donn√©es', 'error');
    }
}

function saveData() {
    try {
        localStorage.setItem('rapaces', JSON.stringify(rapaces));
        localStorage.setItem('entries', JSON.stringify(entries));
        localStorage.setItem('chasses', JSON.stringify(chasses));
        localStorage.setItem('affaitages', JSON.stringify(affaitages));
    } catch (error) {
        console.error('Erreur lors de la sauvegarde:', error);
        showNotification('Erreur lors de la sauvegarde', 'error');
    }
}

// Gestion des onglets
function showTab(tabName) {
    // Masquer tous les onglets
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // D√©sactiver tous les boutons d'onglets
    const tabButtons = document.querySelectorAll('.tab');
    tabButtons.forEach(btn => btn.classList.remove('active'));
    
    // Activer l'onglet s√©lectionn√©
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

// Gestion des rapaces
function addRapace() {
    const name = document.getElementById('rapace-name').value.trim();
    const species = document.getElementById('rapace-species').value.trim();
    const birthdate = document.getElementById('rapace-birthdate').value;
    const sex = document.getElementById('rapace-sex').value;
    
    if (!name || !species) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const rapace = {
        id: Date.now(),
        name: name,
        species: species,
        birthdate: birthdate,
        sex: sex,
        created: new Date().toISOString()
    };
    
    rapaces.push(rapace);
    saveData();
    updateRapaceList();
    updateRapaceSelects();
    
    // R√©initialiser le formulaire
    document.getElementById('rapace-name').value = '';
    document.getElementById('rapace-species').value = '';
    document.getElementById('rapace-birthdate').value = '';
    document.getElementById('rapace-sex').value = 'forme';
    
    showNotification('Rapace ajout√© avec succ√®s');
}

function updateRapaceList() {
    const list = document.getElementById('rapace-list');
    if (!list) return;
    
    if (rapaces.length === 0) {
        list.innerHTML = '<p>Aucun rapace enregistr√©</p>';
        return;
    }
    
    list.innerHTML = rapaces.map(rapace => `
        <div class="rapace-card">
            <div class="rapace-actions">
                <button onclick="editRapace(${rapace.id})" class="btn-warning">Modifier</button>
                <button onclick="deleteRapace(${rapace.id})" class="btn-danger">Supprimer</button>
            </div>
            <h3>${rapace.name}</h3>
            <p><strong>Esp√®ce:</strong> ${rapace.species}</p>
            <p><strong>Sexe:</strong> ${rapace.sex}</p>
            ${rapace.birthdate ? `<p><strong>N√© le:</strong> ${formatDate(rapace.birthdate)}</p>` : ''}
            <p><strong>Ajout√© le:</strong> ${formatDate(rapace.created)}</p>
        </div>
    `).join('');
}

function updateRapaceSelects() {
    const selects = ['rapace-select', 'chasse-rapace', 'affaitage-rapace'];
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            const currentValue = select.value;
            select.innerHTML = '<option value="">Choisir un rapace</option>';
            rapaces.forEach(rapace => {
                const option = document.createElement('option');
                option.value = rapace.id;
                option.textContent = rapace.name;
                if (currentValue == rapace.id) option.selected = true;
                select.appendChild(option);
            });
        }
    });
}

function editRapace(id) {
    const rapace = rapaces.find(r => r.id === id);
    if (!rapace) return;
    
    currentEditId = id;
    document.getElementById('edit-name').value = rapace.name;
    document.getElementById('edit-species').value = rapace.species;
    document.getElementById('edit-birthdate').value = rapace.birthdate || '';
    document.getElementById('edit-sex').value = rapace.sex;
    
    document.getElementById('editModal').style.display = 'block';
}

function saveEdit() {
    if (!currentEditId) return;
    
    const name = document.getElementById('edit-name').value.trim();
    const species = document.getElementById('edit-species').value.trim();
    const birthdate = document.getElementById('edit-birthdate').value;
    const sex = document.getElementById('edit-sex').value;
    
    if (!name || !species) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const rapaceIndex = rapaces.findIndex(r => r.id === currentEditId);
    if (rapaceIndex !== -1) {
        rapaces[rapaceIndex] = {
            ...rapaces[rapaceIndex],
            name: name,
            species: species,
            birthdate: birthdate,
            sex: sex
        };
        
        saveData();
        updateRapaceList();
        updateRapaceSelects();
        closeEditModal();
        showNotification('Rapace modifi√© avec succ√®s');
    }
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
    currentEditId = null;
}

function deleteRapace(id) {
    if (confirm('√ätes-vous s√ªr de vouloir supprimer ce rapace ? Toutes les donn√©es associ√©es seront √©galement supprim√©es.')) {
        rapaces = rapaces.filter(r => r.id !== id);
        entries = entries.filter(e => e.rapaceId !== id);
        chasses = chasses.filter(c => c.rapaceId !== id);
        affaitages = affaitages.filter(a => a.rapaceId !== id);
        
        saveData();
        updateRapaceList();
        updateRapaceSelects();
        updateEntryList();
        updateChasseList();
        updateAffaitageList();
        showNotification('Rapace supprim√© avec succ√®s');
    }
}

// Gestion du suivi
function showEventFields() {
    const eventType = document.getElementById('event-type').value;
    const fields = document.querySelectorAll('.conditional-fields');
    
    fields.forEach(field => field.classList.remove('active'));
    
    const targetField = document.getElementById(eventType + '-fields');
    if (targetField) {
        targetField.classList.add('active');
    }
}

function addEntry() {
    const rapaceId = document.getElementById('rapace-select').value;
    const eventType = document.getElementById('event-type').value;
    const eventDate = document.getElementById('event-date').value;
    const eventTime = document.getElementById('event-time').value;
    const notes = document.getElementById('event-notes').value.trim();
    
    if (!rapaceId || !eventDate || !eventTime) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const entry = {
        id: Date.now(),
        rapaceId: parseInt(rapaceId),
        type: eventType,
        date: eventDate,
        time: eventTime,
        notes: notes,
        created: new Date().toISOString()
    };
    
    // Ajouter des champs sp√©cifiques selon le type
    switch(eventType) {
        case 'nourriture':
            entry.poidsAvant = document.getElementById('poids-avant').value;
            entry.poidsApres = document.getElementById('poids-apres').value;
            entry.menu = document.getElementById('detail-nourriture').value;
            entry.quantite = document.getElementById('quantite-nourriture').value;
            break;
        case 'vol':
            entry.typeVol = document.getElementById('type-vol').value;
            break;
        case 'comportement':
            const reactivite = document.querySelector('input[name="reactivite"]:checked');
            entry.reactivite = reactivite ? reactivite.value : '';
            break;
        case 'sante':
            entry.etatSante = document.getElementById('etat-sante').value;
            break;
        case 'entrainement':
            entry.typeEntrainement = document.getElementById('type-entrainement').value;
            break;
    }
    
    entries.push(entry);
    saveData();
    updateEntryList();
    clearEntryForm();
    showNotification('Entr√©e ajout√©e avec succ√®s');
}

function clearEntryForm() {
    document.getElementById('event-notes').value = '';
    document.getElementById('poids-avant').value = '';
    document.getElementById('poids-apres').value = '';
    document.getElementById('quantite-nourriture').value = '';
    
    // R√©initialiser les radio buttons
    const radios = document.querySelectorAll('input[name="reactivite"]');
    radios.forEach(radio => radio.checked = false);
    
    // R√©initialiser les dates et heures
    const today = new Date();
    const timeInputs = document.querySelectorAll('input[type="time"]');
    timeInputs.forEach(input => {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        input.value = `${hours}:${minutes}`;
    });
}

function updateEntryList() {
    const list = document.getElementById('entry-list');
    if (!list) return;
    
    const selectedRapaceId = document.getElementById('rapace-select').value;
    let filteredEntries = entries;
    
    if (selectedRapaceId) {
        filteredEntries = entries.filter(e => e.rapaceId == selectedRapaceId);
    }
    
    if (filteredEntries.length === 0) {
        list.innerHTML = '<p>Aucune entr√©e trouv√©e</p>';
        return;
    }
    
    // Trier par date et heure d√©croissante
    filteredEntries.sort((a, b) => {
        const dateA = new Date(a.date + 'T' + a.time);
        const dateB = new Date(b.date + 'T' + b.time);
        return dateB - dateA;
    });
    
    list.innerHTML = filteredEntries.slice(0, 10).map(entry => {
        const rapace = rapaces.find(r => r.id === entry.rapaceId);
        const rapaceName = rapace ? rapace.name : 'Rapace inconnu';
        
        let details = '';
        switch(entry.type) {
            case 'nourriture':
                details = `<br><strong>Menu:</strong> ${entry.menu || 'Non pr√©cis√©'}`;
                if (entry.quantite) details += ` (${entry.quantite})`;
                if (entry.poidsAvant && entry.poidsApres) {
                    details += `<br><strong>Poids:</strong> ${entry.poidsAvant}g ‚Üí ${entry.poidsApres}g`;
                }
                break;
            case 'vol':
                details = `<br><strong>Type:</strong> ${entry.typeVol || 'Non pr√©cis√©'}`;
                break;
            case 'comportement':
                if (entry.reactivite) details = `<br><strong>R√©activit√©:</strong> ${entry.reactivite}/5`;
                break;
            case 'sante':
                details = `<br><strong>√âtat:</strong> ${entry.etatSante || 'Non pr√©cis√©'}`;
                break;
            case 'entrainement':
                details = `<br><strong>Type:</strong> ${entry.typeEntrainement || 'Non pr√©cis√©'}`;
                break;
        }
        
        return `
            <div class="entry-item">
                <div class="date">${formatDate(entry.date)} √† ${entry.time} - ${rapaceName}</div>
                <div class="content">
                    <strong>${capitalizeFirst(entry.type)}</strong>
                    ${details}
                    ${entry.notes ? `<br><strong>Notes:</strong> ${entry.notes}` : ''}
                </div>
            </div>
        `;
    }).join('');
}

// Gestion de la chasse
function addChasse() {
    const rapaceId = document.getElementById('chasse-rapace').value;
    const date = document.getElementById('chasse-date').value;
    const time = document.getElementById('chasse-time').value;
    const notes = document.getElementById('chasse-notes').value.trim();
    
    if (!rapaceId || !date || !time) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const chasse = {
        id: Date.now(),
        rapaceId: parseInt(rapaceId),
        date: date,
        time: time,
        notes: notes,
        captures: {
            faisan: parseInt(document.getElementById('chasse-faisan').value) || 0,
            perdrix: parseInt(document.getElementById('chasse-perdrix').value) || 0,
            lapin: parseInt(document.getElementById('chasse-lapin').value) || 0,
            lievre: parseInt(document.getElementById('chasse-lievre').value) || 0,
            canard: parseInt(document.getElementById('chasse-canard').value) || 0,
            oie: parseInt(document.getElementById('chasse-oie').value) || 0,
            autre: parseInt(document.getElementById('chasse-autre').value) || 0
        },
        created: new Date().toISOString()
    };
    
    chasses.push(chasse);
    saveData();
    updateChasseList();
    clearChasseForm();
    showNotification('Chasse enregistr√©e avec succ√®s');
}

function clearChasseForm() {
    document.getElementById('chasse-notes').value = '';
    const inputs = document.querySelectorAll('.hunt-item input[type="number"]');
    inputs.forEach(input => input.value = '0');
}

function updateChasseList() {
    const list = document.getElementById('chasse-list');
    if (!list) return;
    
    if (chasses.length === 0) {
        list.innerHTML = '<p>Aucune chasse enregistr√©e</p>';
        return;
    }
    
    // Trier par date d√©croissante
    const sortedChasses = chasses.sort((a, b) => {
        const dateA = new Date(a.date + 'T' + a.time);
        const dateB = new Date(b.date + 'T' + b.time);
        return dateB - dateA;
    });
    
    list.innerHTML = sortedChasses.map(chasse => {
        const rapace = rapaces.find(r => r.id === chasse.rapaceId);
        const rapaceName = rapace ? rapace.name : 'Rapace inconnu';
        
        const totalCaptures = Object.values(chasse.captures).reduce((sum, val) => sum + val, 0);
        const captureDetails = Object.entries(chasse.captures)
            .filter(([_, count]) => count > 0)
            .map(([animal, count]) => `${animal}: ${count}`)
            .join(', ');
        
        return `
            <div class="entry-item">
                <div class="date">${formatDate(chasse.date)} √† ${chasse.time} - ${rapaceName}</div>
                <div class="content">
                    <strong>Total captures: ${totalCaptures}</strong>
                    ${captureDetails ? `<br>D√©tail: ${captureDetails}` : ''}
                    ${chasse.notes ? `<br><strong>Notes:</strong> ${chasse.notes}` : ''}
                </div>
            </div>
        `;
    }).join('');
}

// Gestion de l'affaitage
function addAffaitage() {
    const rapaceId = document.getElementById('affaitage-rapace').value;
    const date = document.getElementById('affaitage-date').value;
    const time = document.getElementById('affaitage-time').value;
    const notes = document.getElementById('affaitage-notes').value.trim();
    
    if (!rapaceId || !date || !time) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const activites = [];
    const checkboxes = ['prise-nourriture', 'gant', 'filiere', 'libre'];
    checkboxes.forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox && checkbox.checked) {
            activites.push(checkbox.nextElementSibling.textContent);
        }
    });
    
    const affaitage = {
        id: Date.now(),
        rapaceId: parseInt(rapaceId),
        date: date,
        time: time,
        notes: notes,
        activites: activites,
        created: new Date().toISOString()
    };
    
    affaitages.push(affaitage);
    saveData();
    updateAffaitageList();
    clearAffaitageForm();
    showNotification('Affaitage enregistr√© avec succ√®s');
}

function clearAffaitageForm() {
    document.getElementById('affaitage-notes').value = '';
    const checkboxes = ['prise-nourriture', 'gant', 'filiere', 'libre'];
    checkboxes.forEach(id => {
        const checkbox = document.getElementById(id);
        if (checkbox) checkbox.checked = false;
    });
}

function updateAffaitageList() {
    const list = document.getElementById('affaitage-list');
    if (!list) return;
    
    if (affaitages.length === 0) {
        list.innerHTML = '<p>Aucun affaitage enregistr√©</p>';
        return;
    }
    
    // Trier par date d√©croissante
    const sortedAffaitages = affaitages.sort((a, b) => {
        const dateA = new Date(a.date + 'T' + a.time);
        const dateB = new Date(b.date + 'T' + b.time);
        return dateB - dateA;
    });
    
    list.innerHTML = sortedAffaitages.map(affaitage => {
        const rapace = rapaces.find(r => r.id === affaitage.rapaceId);
        const rapaceName = rapace ? rapace.name : 'Rapace inconnu';
        
        return `
            <div class="entry-item">
                <div class="date">${formatDate(affaitage.date)} √† ${affaitage.time} - ${rapaceName}</div>
                <div class="content">
                    <strong>Activit√©s:</strong> ${affaitage.activites.join(', ') || 'Aucune'}
                    ${affaitage.notes ? `<br><strong>Notes:</strong> ${affaitage.notes}` : ''}
                </div>
            </div>
        `;
    }).join('');
}

// Gestion des statistiques
function showTodayStats() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('stats-date').value = today;
    updateStats();
}

function updateStats() {
    const selectedDate = document.getElementById('stats-date').value;
    const statsContent = document.getElementById('stats-content');
    
    if (!selectedDate) {
        statsContent.innerHTML = '<p>Veuillez s√©lectionner une date</p>';
        return;
    }
    
    const dayEntries = entries.filter(e => e.date === selectedDate);
    const dayChasses = chasses.filter(c => c.date === selectedDate);
    const dayAffaitages = affaitages.filter(a => a.date === selectedDate);
    
    const stats = {
        totalEntries: dayEntries.length,
        totalChasses: dayChasses.length,
        totalAffaitages: dayAffaitages.length,
        totalCaptures: dayChasses.reduce((sum, chasse) => 
            sum + Object.values(chasse.captures).reduce((s, v) => s + v, 0), 0),
        rapacesActifs: [...new Set([
            ...dayEntries.map(e => e.rapaceId),
            ...dayChasses.map(c => c.rapaceId),
            ...dayAffaitages.map(a => a.rapaceId)
        ])].length
    };
    
    statsContent.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Entr√©es de suivi</h3>
                <div class="value">${stats.totalEntries}</div>
            </div>
            <div class="stat-card">
                <h3>Sorties de chasse</h3>
                <div class="value">${stats.totalChasses}</div>
            </div>
            <div class="stat-card">
                <h3>S√©ances d'affaitage</h3>
                <div class="value">${stats.totalAffaitages}</div>
            </div>
            <div class="stat-card">
                <h3>Captures totales</h3>
                <div class="value">${stats.totalCaptures}</div>
            </div>
            <div class="stat-card">
                <h3>Rapaces actifs</h3>
                <div class="value">${stats.rapacesActifs}</div>
            </div>
        </div>
    `;
    
    if (dayEntries.length > 0 || dayChasses.length > 0 || dayAffaitages.length > 0) {
        statsContent.innerHTML += `
            <div class="day-card">
                <h4>D√©tails pour le ${formatDate(selectedDate)}</h4>
                ${dayEntries.length > 0 ? `<p><strong>Suivi:</strong> ${dayEntries.length} entr√©es</p>` : ''}
                ${dayChasses.length > 0 ? `<p><strong>Chasse:</strong> ${dayChasses.length} sorties</p>` : ''}
                ${dayAffaitages.length > 0 ? `<p><strong>Affaitage:</strong> ${dayAffaitages.length} s√©ances</p>` : ''}
            </div>
        `;
    }
}

// Fonctions de d√©monstration
function addDemoRapace() {
    const name = document.getElementById('demo-name').value.trim();
    const species = document.getElementById('demo-species').value.trim();
    
    if (!name || !species) {
        showNotification('Veuillez remplir les champs', 'error');
        return;
    }
    
    const rapace = {
        id: Date.now(),
        name: name,
        species: species,
        birthdate: '2022-05-15',
        sex: 'forme',
        created: new Date().toISOString()
    };
    
    rapaces.push(rapace);
    saveData();
    updateRapaceList();
    updateRapaceSelects();
    showCurrentData();
    showNotification('Rapace de d√©mo ajout√©');
}

function generateDemoData() {
    const demoRapaces = [
        { name: 'Aigle Royal', species: 'Aquila chrysaetos', sex: 'forme', birthdate: '2021-03-20' },
        { name: 'Faucon P√®lerin', species: 'Falco peregrinus', sex: 'tiercelet', birthdate: '2022-04-15' },
        { name: 'Buse de Harris', species: 'Parabuteo unicinctus', sex: 'forme', birthdate: '2022-06-10' },
        { name: '√âpervier d\'Europe', species: 'Accipiter nisus', sex: 'tiercelet', birthdate: '2023-05-05' }
    ];
    
    demoRapaces.forEach((rapaceData, index) => {
        const rapace = {
            id: Date.now() + index,
            name: rapaceData.name,
            species: rapaceData.species,
            birthdate: rapaceData.birthdate,
            sex: rapaceData.sex,
            created: new Date().toISOString()
        };
        rapaces.push(rapace);
    });
    
    // Ajouter des entr√©es de d√©monstration
    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    
    const demoEntries = [
        {
            id: Date.now() + 1000,
            rapaceId: rapaces[rapaces.length - 1].id,
            type: 'nourriture',
            date: today.toISOString().split('T')[0],
            time: '08:00',
            notes: 'Repas du matin',
            poidsAvant: '850',
            poidsApres: '920',
            menu: 'poussin',
            quantite: '150g',
            created: new Date().toISOString()
        },
        {
            id: Date.now() + 1001,
            rapaceId: rapaces[rapaces.length - 2].id,
            type: 'vol',
            date: yesterday.toISOString().split('T')[0],
            time: '14:30',
            notes: 'Excellent vol, tr√®s r√©actif',
            typeVol: 'entrainement',
            created: new Date().toISOString()
        }
    ];
    
    entries.push(...demoEntries);
    
    saveData();
    updateRapaceList();
    updateRapaceSelects();
    updateEntryList();
    showCurrentData();
    showNotification('Donn√©es de d√©monstration g√©n√©r√©es');
}

function clearAllDemoData() {
    if (confirm('√ätes-vous s√ªr de vouloir supprimer toutes les donn√©es ?')) {
        rapaces = [];
        entries = [];
        chasses = [];
        affaitages = [];
        saveData();
        updateRapaceList();
        updateRapaceSelects();
        updateEntryList();
        updateChasseList();
        updateAffaitageList();
        showCurrentData();
        showNotification('Toutes les donn√©es ont √©t√© supprim√©es');
    }
}

function showCurrentData() {
    const demoData = document.getElementById('demo-data');
    if (!demoData) return;
    
    demoData.innerHTML = `
        üìä Rapaces: ${rapaces.length}
        üìù Entr√©es de suivi: ${entries.length}
        üéØ Chasses: ${chasses.length}
        üèπ Affaitages: ${affaitages.length}
        
        üìÖ Derni√®re sauvegarde: ${new Date().toLocaleString()}
    `;
}

// Fonctions utilitaires
function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString + 'T00:00:00');
    return date.toLocaleDateString('fr-FR');
}

function capitalizeFirst(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    if (type === 'error') {
        notification.style.background = '#dc3545';
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Sauvegarde automatique toutes les 30 secondes
setInterval(saveData, 30000);

// Gestion des clics sur la modal
window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target === modal) {
        closeEditModal();
    }
}
</script>

</body>
</html>