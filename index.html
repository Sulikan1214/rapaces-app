            <p style="font-size: 14px; color: #666;">
                Cliquez sur "Connecter Google Drive" et autorisez l'acc√®s pour synchroniser vos donn√©es automatiquement.
            </p>
        </div>

        <div style="margin: 20px 0;">
            <h3>‚öôÔ∏è Param√®tres de synchronisation</h3>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="auto-sync-enabled" checked onchange="toggleAutoSync()">
                    <label for="auto-sync-enabled">Synchronisation automatique (toutes les 2 minutes)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="sync-on-change-enabled" checked>
                    <label for="sync-on-change-enabled">Synchroniser √† chaque modification</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="sync-notifications" checked>
                    <label for="sync-notifications">Notifications de synchronisation</label>
                </div>
            </div>
        </div>

        <div style="margin: 20px 0;">
            <h3>üì± Instructions multi-appareils</h3>
            <div class="day-card" style="background: #e8f4fd;">
                <p><strong>1. Sur cet appareil :</strong></p>
                <p>‚Ä¢ Cliquez "üîó Connecter Google Drive"</p>
                <p>‚Ä¢ Autorisez l'acc√®s √† votre Google Drive</p>
                <p>‚Ä¢ Vos donn√©es seront sauvegard√©es automatiquement</p>
                
                <p><strong>2. Sur vos autres appareils :</strong></p>
                <p>‚Ä¢ Ouvrez cette application</p>
                <p>‚Ä¢ Allez dans l'onglet "Sync Drive"</p>
                <p>‚Ä¢ Connectez-vous avec le M√äME compte Google</p>
                <p>‚Ä¢ Vos donn√©es se synchroniseront automatiquement !</p>
            </div>
        </div>

        <div style="margin: 20px 0;">
            <h3>üìä Historique de synchronisation</h3>
            <div id="sync-history" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <p style="color: #666; font-style: italic;">Connectez-vous √† Google Drive pour voir l'historique</p>
            </div>
        </div>

        <div class="day-card" style="background: #e3f2fd;">
            <h4>‚ÑπÔ∏è Comment √ßa marche</h4>
            <p>‚Ä¢ Vos donn√©es sont stock√©es de mani√®re s√©curis√©e dans votre Google Drive personnel</p>
            <p>‚Ä¢ Seuls vos appareils connect√©s avec le m√™me compte Google peuvent y acc√©der</p>
            <p>‚Ä¢ La synchronisation est bidirectionnelle : les modifications se propagent partout</p>
            <p>‚Ä¢ En cas de conflit, la version la plus r√©cente est conserv√©e</p>
            <p>‚Ä¢ Vous gardez le contr√¥le total : d√©connexion possible √† tout moment</p>
        </div>
    </div>
</div>

<!-- Modal pour √©dition -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditModal()">&times;</span>
        <h2>Modifier le Rapace</h2>
        <div class="form-group">
            <label for="edit-name">Nom :</label>
            <input type="text" id="edit-name">
        </div>
        <div class="form-group">
            <label for="edit-species">Esp√®ce :</label>
            <input type="text" id="edit-species">
        </div>
        <div class="form-group">
            <label for="edit-birthdate">Date de naissance :</label>
            <input type="date" id="edit-birthdate">
        </div>
        <div class="form-group">
            <label for="edit-sex">Sexe :</label>
            <select id="edit-sex">
                <option value="forme">Forme</option>
                <option value="tiercelet">Tiercelet</option>
            </select>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="saveRapaceEdit()">üíæ Sauvegarder</button>
            <button onclick="closeEditModal()" class="btn-secondary">‚ùå Annuler</button>
        </div>
    </div>
</div>

<script>
// Variables globales
var rapaces = [];
var entries = [];
var chasseEntries = [];
var affaitageEntries = [];
var currentWeather = null;
var currentLocation = "Orthez (64300)";
var currentStatsDate = new Date();
var editingRapaceId = null;

// Variables pour Google Drive synchronisation
var isGoogleDriveConnected = false;
var syncIntervalId = null;
var lastSyncTime = null;
var googleDriveFileId = null;
var syncHistory = [];

// Configuration Google Drive avec VOS identifiants
var GOOGLE_CLIENT_ID = '527668276228-b0me60t3sh1qa2h8kol18lham6cuf2nm.apps.googleusercontent.com';
var GOOGLE_API_KEY = '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';
var DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
var SCOPES = 'https://www.googleapis.com/auth/drive.file';
var FILENAME = 'rapaces_data_sync.json';

// ===== GOOGLE DRIVE SYNCHRONISATION =====

// Charger l'API Google
function loadGoogleAPI() {
    if (typeof gapi === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://apis.google.com/js/api.js';
        script.onload = function() {
            gapi.load('auth2:client', initGoogleAPI);
        };
        document.head.appendChild(script);
    } else {
        gapi.load('auth2:client', initGoogleAPI);
    }
}

// Initialiser l'API Google
async function initGoogleAPI() {
    try {
        await gapi.client.init({
            apiKey: GOOGLE_API_KEY,
            clientId: GOOGLE_CLIENT_ID,
            discoveryDocs: [DISCOVERY_DOC],
            scope: SCOPES
        });
        
        addSyncHistoryEntry('‚úÖ API Google Drive initialis√©e');
        
        // V√©rifier si d√©j√† connect√©
        const authInstance = gapi.auth2.getAuthInstance();
        if (authInstance.isSignedIn.get()) {
            isGoogleDriveConnected = true;
            updateSyncUI();
            addSyncHistoryEntry('üîÑ Reconnexion automatique r√©ussie');
            await loadFromGoogleDrive();
            startAutoSync();
        }
    } catch (error) {
        console.error('Erreur initialisation Google Drive:', error);
        addSyncHistoryEntry('‚ùå Erreur initialisation API : ' + error.message);
    }
}

// Connecter √† Google Drive
async function initGoogleDriveSync() {
    try {
        addSyncHistoryEntry('üîÑ Tentative de connexion...');
        updateSyncUI();
        
        const authInstance = gapi.auth2.getAuthInstance();
        const user = await authInstance.signIn();
        
        if (user.isSignedIn()) {
            isGoogleDriveConnected = true;
            addSyncHistoryEntry('‚úÖ Connexion r√©ussie √† Google Drive');
            updateSyncUI();
            
            // Charger les donn√©es existantes depuis le cloud
            await loadFromGoogleDrive();
            
            // Puis synchroniser les donn√©es locales
            await syncToGoogleDrive(true);
            startAutoSync();
            
            if (document.getElementById('sync-notifications').checked) {
                showMiniNotification('‚úÖ Connect√© √† Google Drive !');
            }
        }
    } catch (error) {
        console.error('Erreur connexion:', error);
        addSyncHistoryEntry('‚ùå Erreur de connexion : ' + (error.error || error.message));
        if (document.getElementById('sync-notifications').checked) {
            showMiniNotification('‚ùå Erreur de connexion √† Google Drive');
        }
    }
}

// D√©connecter de Google Drive
async function disconnectDrive() {
    try {
        const authInstance = gapi.auth2.getAuthInstance();
        await authInstance.signOut();
        
        isGoogleDriveConnected = false;
        stopAutoSync();
        addSyncHistoryEntry('‚ùå D√©connexion de Google Drive');
        updateSyncUI();
        
        if (document.getElementById('sync-notifications').checked) {
            showMiniNotification('‚ùå D√©connect√© de Google Drive');
        }
    } catch (error) {
        console.error('Erreur d√©connexion:', error);
        addSyncHistoryEntry('‚ùå Erreur d√©connexion : ' + error.message);
    }
}

// Synchroniser vers Google Drive
async function syncToGoogleDrive(showNotification = false) {
    if (!isGoogleDriveConnected) return;
    
    try {
        const data = {
            rapaces: rapaces,
            entries: entries,
            chasseEntries: chasseEntries,
            affaitageEntries: affaitageEntries,
            currentLocation: currentLocation,
            lastSync: new Date().toISOString(),
            deviceInfo: {
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            }
        };
        
        const fileContent = JSON.stringify(data, null, 2);
        
        // Chercher le fichier existant
        let fileId = await findSyncFile();
        
        let response;
        if (fileId) {
            // Mettre √† jour le fichier existant
            response = await gapi.client.request({
                path: `https://www.googleapis.com/upload/drive/v3/files/${fileId}`,
                method: 'PATCH',
                params: { uploadType: 'media' },
                headers: { 'Content-Type': 'application/json' },
                body: fileContent
            });
        } else {
            // Cr√©er un nouveau fichier
            const fileMetadata = {
                name: FILENAME,
                parents: ['appDataFolder']
            };
            
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
            form.append('file', new Blob([fileContent], {type: 'application/json'}));
            
            const authResponse = gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse();
            response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authResponse.access_token}`
                },
                body: form
            });
            
            if (response.ok) {
                const result = await response.json();
                googleDriveFileId = result.id;
            }
        }
        
        if (response && (response.status === 200 || response.ok)) {
            lastSyncTime = new Date();
            addSyncHistoryEntry('üì§ Synchronisation vers Google Drive r√©ussie');
            updateSyncUI();
            
            if (showNotification && document.getElementById('sync-notifications').checked) {
                showMiniNotification('‚úÖ Donn√©es synchronis√©es sur Google Drive');
            }
        }
    } catch (error) {
        console.error('Erreur sync vers Drive:', error);
        addSyncHistoryEntry('‚ùå Erreur synchronisation : ' + error.message);
    }
}

// Charger depuis Google Drive
async function loadFromGoogleDrive() {
    if (!isGoogleDriveConnected) return;
    
    try {
        const fileId = await findSyncFile();
        if (!fileId) {
            addSyncHistoryEntry('üìä Aucun fichier de sauvegarde trouv√©');
            return;
        }
        
        const response = await gapi.client.drive.files.get({
            fileId: fileId,
            alt: 'media'
        });
        
        if (response.status === 200) {
            const data = JSON.parse(response.body);
            
            // V√©rifier si les donn√©es cloud sont plus r√©centes
            const localData = localStorage.getItem('rapaces_data');
            const localLastSave = localData ? JSON.parse(localData).lastSave : null;
            
            if (!localLastSave || new Date(data.lastSync) > new Date(localLastSave)) {
                // Charger les donn√©es cloud
                rapaces = data.rapaces || [];
                entries = data.entries || [];
                chasseEntries = data.chasseEntries || [];
                affaitageEntries = data.affaitageEntries || [];
                currentLocation = data.currentLocation || currentLocation;
                
                // Mettre √† jour l'interface
                updateRapaceList();
                updateRapaceSelects();
                updateEntryList();
                updatechasseList();
                updateAffaitageList();
                
                // Sauvegarder localement
                saveAllData();
                
                addSyncHistoryEntry('üì• Donn√©es charg√©es depuis Google Drive');
                if (document.getElementById('sync-notifications').checked) {
                    showMiniNotification('üì• Donn√©es mises √† jour depuis le cloud');
                }
            } else {
                addSyncHistoryEntry('üìä Donn√©es locales plus r√©centes');
            }
        }
    } catch (error) {
        console.error('Erreur chargement depuis Drive:', error);
        addSyncHistoryEntry('‚ùå Erreur chargement : ' + error.message);
    }
}

// Trouver le fichier de synchronisation
async function findSyncFile() {
    try {
        const response = await gapi.client.drive.files.list({
            q: `name='${FILENAME}' and parents in 'appDataFolder'`,
            spaces: 'appDataFolder',
            fields: 'files(id, name)'
        });
        
        const files = response.result.files;
        if (files && files.length > 0) {
            googleDriveFileId = files[0].id;
            return files[0].id;
        }
        return null;
    } catch (error) {
        console.error('Erreur recherche fichier:', error);
        return null;
    }
}

// Synchronisation manuelle
async function manualSync() {
    if (!isGoogleDriveConnected) {
        if (document.getElementById('sync-notifications').checked) {
            showMiniNotification('‚ùå Connectez-vous d\'abord √† Google Drive');
        }
        return;
    }
    
    addSyncHistoryEntry('üîÑ Synchronisation manuelle lanc√©e...');
    updateSyncUI();
    
    try {
        // D'abord charger depuis Google Drive
        await loadFromGoogleDrive();
        
        // Puis sauvegarder vers Google Drive
        await syncToGoogleDrive(true);
        
        addSyncHistoryEntry('‚úÖ Synchronisation manuelle termin√©e');
    } catch (error) {
        addSyncHistoryEntry('‚ùå Erreur synchronisation manuelle : ' + error.message);
    }
}

// D√©marrer la synchronisation automatique
function startAutoSync() {
    stopAutoSync();
    
    if (isGoogleDriveConnected && document.getElementById('auto-sync-enabled') && document.getElementById('auto-sync-enabled').checked) {
        syncIntervalId = setInterval(async function() {
            try {
                await loadFromGoogleDrive();
                await syncToGoogleDrive(false);
            } catch (error) {
                console.error('Erreur auto-sync:', error);
            }
        }, 2 * 60 * 1000); // 2 minutes
        
        addSyncHistoryEntry('üîÑ Synchronisation automatique activ√©e (2 min)');
    }
}

// Arr√™ter la synchronisation automatique
function stopAutoSync() {
    if (syncIntervalId) {
        clearInterval(syncIntervalId);
        syncIntervalId = null;
        addSyncHistoryEntry('‚èπÔ∏è Synchronisation automatique arr√™t√©e');
    }
}

// Basculer la synchronisation automatique
function toggleAutoSync() {
    if (isGoogleDriveConnected) {
        if (document.getElementById('auto-sync-enabled').checked) {
            startAutoSync();
        } else {
            stopAutoSync();
        }
    }
}

// Mettre √† jour l'interface de synchronisation
function updateSyncUI() {
    const statusContainer = document.getElementById('sync-status-container');
    const statusEl = document.getElementById('sync-status');
    const detailsEl = document.getElementById('sync-details');
    const lastSyncEl = document.getElementById('last-sync-time');
    const connectBtn = document.getElementById('connect-drive-btn');
    const syncBtn = document.getElementById('manual-sync-btn');
    const disconnectBtn = document.getElementById('disconnect-drive-btn');
    
    if (!statusEl) return;
    
    if (isGoogleDriveConnected) {
        statusContainer.className = 'sync-status connected';
        statusEl.textContent = '‚úÖ Google Drive connect√©';
        detailsEl.textContent = 'üîÑ Synchronisation active';
        
        if (lastSyncTime) {
            lastSyncEl.textContent = 'Derni√®re sync : ' + lastSyncTime.toLocaleString('fr-FR');
        } else {
            lastSyncEl.textContent = 'Derni√®re sync : En cours...';
        }
        
        connectBtn.style.display = 'none';
        syncBtn.style.display = 'inline-block';
        disconnectBtn.style.display = 'inline-block';
    } else {
        statusContainer.className = 'sync-status disconnected';
        statusEl.textContent = '‚ùå Google Drive non connect√©';
        detailsEl.textContent = 'Pr√™t √† se connecter - cliquez sur le bouton ci-dessous';
        lastSyncEl.textContent = 'Derni√®re sync : Jamais';
        
        connectBtn.style.display = 'inline-block';
        syncBtn.style.display = 'none';
        disconnectBtn.style.display = 'none';
    }
}

// Ajouter une entr√©e √† l'historique de synchronisation
function addSyncHistoryEntry(message) {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('fr-FR');
    syncHistory.unshift(`${timeStr} - ${message}`);
    
    if (syncHistory.length > 15) {
        syncHistory = syncHistory.slice(0, 15);
    }
    
    const historyEl = document.getElementById('sync-history');
    if (historyEl) {
        if (syncHistory.length === 0) {
            historyEl.innerHTML = '<p style="color: #666; font-style: italic;">Connectez-vous √† Google Drive pour voir l\'historique</p>';
        } else {
            historyEl.innerHTML = syncHistory.map(entry => 
                `<p style="margin: 5px 0; font-size: 14px;">${entry}</p>`
            ).join('');
        }
    }
}

// Afficher une mini notification
function showMiniNotification(message) {
    if (!document.getElementById('sync-notifications').checked) return;
    
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(function() {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Sauvegarder avec sync Google Drive
function saveAllData() {
    try {
        const data = {
            rapaces: rapaces,
            entries: entries,
            chasseEntries: chasseEntries,
            affaitageEntries: affaitageEntries,
            currentLocation: currentLocation,
            lastSave: new Date().toISOString()
        };
        localStorage.setItem('rapaces_data', JSON.stringify(data));
        
        // Synchroniser avec Google Drive si connect√© et activ√©
        if (isGoogleDriveConnected && 
            document.getElementById('sync-on-change-enabled') && 
            document.getElementById('sync-on-change-enabled').checked) {
            syncToGoogleDrive(false);
        }
    } catch (e) {
        console.error('Erreur sauvegarde:', e);
    }
}

// Charger les donn√©es locales
function loadAllData() {
    try {
        var savedData = localStorage.getItem('rapaces_data');
        if (savedData) {
            var data = JSON.parse(savedData);
            rapaces = data.rapaces || [];
            entries = data.entries || [];
            chasseEntries = data.chasseEntries || [];
            affaitageEntries = data.affaitageEntries || [];
            currentLocation = data.currentLocation || "Orthez (64300)";
            return true;
        }
    } catch (e) {
        console.error('Erreur chargement:', e);
    }
    return false;
}

// M√©t√©o simplifi√©e
function loadWeather() {
    var weatherElement = document.getElementById('weather-info');
    if (weatherElement) {
        weatherElement.innerHTML = 'üå§Ô∏è <strong>Ensoleill√©</strong><br><span style="font-size: 12px;">15¬∞C ‚Ä¢ ' + currentLocation + '</span>';
    }
    currentWeather = "Ensoleill√©, 15¬∞C √† " + currentLocation;
}

function refreshWeather() {
    loadWeather();
}

function changeLocation() {
    var newLocation = prompt("Entrez votre localisation :", currentLocation);
    if (newLocation && newLocation.trim()) {
        currentLocation = newLocation.trim();
        saveAllData();
        loadWeather();
    }
}

// Calcul de l'√¢ge
function calculateAge(birthDate) {
    var today = new Date();
    var birth = new Date(birthDate);
    var age = today.getFullYear() - birth.getFullYear();
    var monthDiff = today.getMonth() - birth.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
    }
    
    return age;
}

// Gestion des onglets
function showTab(tabName) {
    var contents = document.querySelectorAll('.tab-content');
    var tabs = document.querySelectorAll('.tab');
    
    for (var i = 0; i < contents.length; i++) {
        contents[i].classList.remove('active');
    }
    
    for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
    }
    
    document.getElementById(tabName).classList.add('active');
    var activeTab = document.querySelector("[onclick=\"showTab('" + tabName + "')\"]");
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    if (tabName === 'stats') {
        updateStats();
    } else if (tabName === 'sync') {
        updateSyncUI();
    }
}

// Champs conditionnels
function showEventFields() {
    var eventType = document.getElementById('event-type').value;
    var fields = document.querySelectorAll('.conditional-fields');
    
    for (var i = 0; i < fields.length; i++) {
        fields[i].classList.remove('active');
    }
    
    var targetField = document.getElementById(eventType + '-fields');
    if (targetField) {
        targetField.classList.add('active');
    }
}

// Ajouter rapace
function addRapace() {
    var name = document.getElementById('rapace-name').value;
    var species = document.getElementById('rapace-species').value;
    var birthdate = document.getElementById('rapace-birthdate').value;
    var sex = document.getElementById('rapace-sex').value;

    if (!name || !species || !birthdate) {
        alert('Merci de remplir tous les champs');
        return;
    }

    var age = calculateAge(birthdate);

    var rapace = {
        id: Date.now(),
        name: name,
        species: species,
        birthdate: birthdate,
        age: age,
        sex: sex,
        dateAdded: new Date().toISOString()
    };

    rapaces.push(rapace);
    saveAllData();
    updateRapaceList();
    updateRapaceSelects();
    
    document.getElementById('rapace-name').value = '';
    document.getElementById('rapace-species').value = '';
    document.getElementById('rapace-birthdate').value = '';
    
    showMiniNotification('‚úÖ Rapace ajout√© !');
}

// Liste rapaces
function updateRapaceList() {
    var list = document.getElementById('rapace-list');
    list.innerHTML = '';
    
    if (rapaces.length === 0) {
        list.innerHTML = '<p style="text-align:center; color: #666;">Aucun rapace ajout√©</p>';
        return;
    }

    for (var i = 0; i < rapaces.length; i++) {
        var rapace = rapaces[i];
        var div = document.createElement('div');
        div.className = 'rapace-card';
        
        rapace.age = calculateAge(rapace.birthdate);
        
        div.innerHTML = '<div class="rapace-actions">' +
                        '<button onclick="editRapace(' + rapace.id + ')" class="btn-warning">‚úèÔ∏è</button>' +
                        '<button onclick="deleteRapace(' + rapace.id + ')" class="btn-danger">üóëÔ∏è</button>' +
                        '</div>' +
                        '<h3>' + rapace.name + '</h3>' +
                        '<p><strong>Esp√®ce :</strong> ' + rapace.species + '</p>' +
                        '<p><strong>√Çge :</strong> ' + rapace.age + ' ans</p>' +
                        '<p><strong>Sexe :</strong> ' + rapace.sex + '</p>' +
                        '<p><strong>N√© le :</strong> ' + new Date(rapace.birthdate).toLocaleDateString('fr-FR') + '</p>';
        list.appendChild(div);
    }
}

// √âdition rapace
function editRapace(rapaceId) {
    var rapace = rapaces.find(r => r.id === rapaceId);
    if (!rapace) return;
    
    editingRapaceId = rapaceId;
    document.getElementById('edit-name').value = rapace.name;
    document.getElementById('edit-species').value = rapace.species;
    document.getElementById('edit-birthdate').value = rapace.birthdate;
    document.getElementById('edit-sex').value = rapace.sex;
    
    document.getElementById('editModal').style.display = 'block';
}

function saveRapaceEdit() {
    if (!editingRapaceId) return;
    
    var rapace = rapaces.find(r => r.id === editingRapaceId);
    if (!rapace) return;
    
    var name = document.getElementById('edit-name').value;
    var species = document.getElementById('edit-species').value;
    var birthdate = document.getElementById('edit-birthdate').value;
    var sex = document.getElementById('edit-sex').value;
    
    if (!name || !species || !birthdate) {
        alert('Merci de remplir tous les champs');
        return;
    }
    
    rapace.name = name;
    rapace.species = species;
    rapace.birthdate = birthdate;
    rapace.age = calculateAge(birthdate);
    rapace.sex = sex;
    
    saveAllData();
    updateRapaceList();
    updateRapaceSelects();
    closeEditModal();
    
    showMiniNotification('‚úÖ Rapace modifi√© !');
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
    editingRapaceId = null;
}

function deleteRapace(rapaceId) {
    var rapace = rapaces.find(r => r.id === rapaceId);
    if (!rapace) return;
    
    if (confirm('Supprimer ' + rapace.name + ' et tout son historique ?')) {
        rapaces = rapaces.filter(r => r.id !== rapaceId);
        entries = entries.filter(e => e.rapaceId !== rapaceId);
        chasseEntries = chasseEntries.filter(c => c.rapaceId !== rapaceId);
        affaitageEntries = affaitageEntries.filter(a => a.rapaceId !== rapaceId);
        
        saveAllData();
        updateRapaceList();
        updateRapaceSelects();
        updateEntryList();
        updatechasseList();
        updateAffaitageList();
        
        showMiniNotification('‚úÖ Rapace supprim√© !');
    }
}

// Mise √† jour selects
function updateRapaceSelects() {
    var selects = ['rapace-select', 'chasse-rapace', 'affaitage-rapace'];
    
    for (var s = 0; s < selects.length; s++) {
        var select = document.getElementById(selects[s]);
        if (select) {
            var currentValue = select.value;
            select.innerHTML = '<option value="">Choisir un rapace</option>';
            
            for (var i = 0; i < rapaces.length; i++) {
                var rapace = rapaces[i];
                var option = document.createElement('option');
                option.value = rapace.id;
                option.textContent = rapace.name;
                select.appendChild(option);
            }
            
            select.value = currentValue;
        }
    }
}

// Ajouter entr√©e
function addEntry() {
    var rapaceId = document.getElementById('rapace-select').value;
    var type = document.getElementById('event-type').value;
    var date = document.getElementById('event-date').value;
    var time = document.getElementById('event-time').value;
    var notes = document.getElementById('event-notes').value;

    if (!rapaceId || !date || !time) {
        <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionnaire de Rapaces</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><circle cx='100' cy='100' r='95' fill='white' stroke='%23333' stroke-width='10'/><g transform='translate(100,100) scale(0.8)'><path d='M-60,-20 Q-40,-60 0,-40 Q40,-60 60,-20 Q50,-40 20,-30 Q10,-50 0,-35 Q-10,-50 -20,-30 Q-50,-40 -60,-20' fill='%23333'/><circle cx='-25' cy='-25' r='5' fill='%23333'/><path d='M-10,-10 Q0,0 10,-10 Q15,-5 5,-5 Q-5,-5 -10,-10' fill='%23333'/><path d='M-40,10 Q-20,20 0,10 Q20,20 40,10 Q30,30 0,25 Q-30,30 -40,10' fill='%23333'/><path d='M-30,-10 Q-20,0 -10,-10 M10,-10 Q20,0 30,-10' stroke='%23333' stroke-width='2' fill='none'/><path d='M-70,-30 Q-50,-10 -30,-20 M30,-20 Q50,-10 70,-30' stroke='%23333' stroke-width='3' fill='none'/><path d='M-60,20 Q-40,40 -20,30 M20,30 Q40,40 60,20' stroke='%23333' stroke-width='3' fill='none'/><circle cx='45' cy='45' r='2' fill='%23333'/><circle cx='-35' cy='55' r='1.5' fill='%23333'/><rect x='-15' y='35' width='4' height='2' fill='%23333'/></g></svg>" type="image/svg+xml">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .weather-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button.btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        button.btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #545b62 100%);
        }

        button.btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }

        .entry-item {
            background: #f0f4f8;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2a5298;
        }

        .entry-item .date {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .entry-item .content {
            color: #333;
        }

        .rapace-card {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            border: 2px solid #e3f2fd;
            position: relative;
        }

        .rapace-card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .rapace-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        .rapace-actions button {
            padding: 8px 12px;
            font-size: 12px;
        }

        .weather-info {
            color: #e3f2fd;
            font-size: 14px;
        }

        .conditional-fields {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f0f4f8;
            border-radius: 8px;
        }

        .conditional-fields.active {
            display: block;
        }

        .rating-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .rating-group input[type="radio"] {
            width: auto;
        }

        .hunt-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .hunt-item {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e3f2fd;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .day-card {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #2a5298;
        }

        .day-card h4 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .day-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .sync-status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }

        .sync-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .sync-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .sync-status.syncing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4285f4;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
            <svg width="80" height="80" viewBox="0 0 200 200" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));">
                <circle cx="100" cy="100" r="95" fill="white" stroke="#1e3c72" stroke-width="8"/>
                <g transform="translate(100,100) scale(0.7)">
                    <path d="M-70,-30 Q-50,-70 0,-50 Q50,-70 70,-30 Q60,-50 30,-40 Q15,-65 0,-45 Q-15,-65 -30,-40 Q-60,-50 -70,-30" fill="#1e3c72"/>
                    <circle cx="-30" cy="-30" r="8" fill="white"/>
                    <circle cx="-28" cy="-32" r="5" fill="#1e3c72"/>
                    <circle cx="-26" cy="-34" r="2" fill="white"/>
                    <path d="M-15,-15 Q5,5 15,-15 Q20,-10 10,-8 Q-10,-8 -15,-15" fill="#2a5298"/>
                    <path d="M-50,15 Q-30,30 0,15 Q30,30 50,15 Q40,40 0,35 Q-40,40 -50,15" fill="#1e3c72"/>
                </g>
            </svg>
            <div>
                <h1>ü¶Ö Gestionnaire de Rapaces</h1>
                <p>Synchronisation Google Drive int√©gr√©e</p>
            </div>
        </div>
        <div class="weather-controls">
            <p id="weather-info" class="weather-info">üå¶Ô∏è Chargement m√©t√©o...</p>
            <button onclick="refreshWeather()" style="padding: 8px 16px; font-size: 12px;">üîÑ</button>
            <button onclick="changeLocation()" style="padding: 8px 16px; font-size: 12px;">üìç</button>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('gestion')">Gestion</button>
        <button class="tab" onclick="showTab('suivi')">Suivi</button>
        <button class="tab" onclick="showTab('chasse')">Chasse</button>
        <button class="tab" onclick="showTab('affaitage')">Affaitage</button>
        <button class="tab" onclick="showTab('stats')">Statistiques</button>
        <button class="tab" onclick="showTab('sync')">Sync Drive</button>
    </div>

    <div id="gestion" class="tab-content active">
        <h2>Ajouter un Rapace</h2>
        <div class="form-group">
            <label for="rapace-name">Nom du rapace :</label>
            <input type="text" id="rapace-name" placeholder="Ex: Aigle royal">
        </div>
        <div class="form-group">
            <label for="rapace-species">Esp√®ce :</label>
            <input type="text" id="rapace-species" placeholder="Ex: Aquila chrysaetos">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="rapace-birthdate">Date de naissance :</label>
                <input type="date" id="rapace-birthdate">
            </div>
            <div class="form-group">
                <label for="rapace-sex">Sexe :</label>
                <select id="rapace-sex">
                    <option value="forme">Forme</option>
                    <option value="tiercelet">Tiercelet</option>
                </select>
            </div>
        </div>
        <button onclick="addRapace()">Ajouter le Rapace</button>

        <h2 style="margin-top: 40px;">Mes Rapaces</h2>
        <div id="rapace-list"></div>
    </div>

    <div id="suivi" class="tab-content">
        <h2>Suivi Quotidien</h2>
        <div class="form-group">
            <label for="rapace-select">S√©lectionner un rapace :</label>
            <select id="rapace-select" onchange="updateEntryList()">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-group">
            <label for="event-type">Type d'√©v√©nement :</label>
            <select id="event-type" onchange="showEventFields()">
                <option value="nourriture">Nourriture</option>
                <option value="vol">Vol</option>
                <option value="comportement">Comportement</option>
                <option value="sante">Sant√©</option>
                <option value="entrainement">Entra√Ænement</option>
            </select>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="event-date">Date :</label>
                <input type="date" id="event-date">
            </div>
            <div class="form-group">
                <label for="event-time">Heure :</label>
                <input type="time" id="event-time">
            </div>
        </div>
        
        <div class="form-group">
            <label for="event-notes">Notes :</label>
            <textarea id="event-notes" rows="3" placeholder="Observations..."></textarea>
        </div>

        <!-- Champs conditionnels pour Nourriture -->
        <div id="nourriture-fields" class="conditional-fields active">
            <div class="form-row">
                <div class="form-group">
                    <label for="poids-avant">Poids avant (g) :</label>
                    <input type="number" id="poids-avant" min="0">
                </div>
                <div class="form-group">
                    <label for="poids-apres">Poids apr√®s (g) :</label>
                    <input type="number" id="poids-apres" min="0">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="detail-nourriture">Menu :</label>
                    <select id="detail-nourriture">
                        <option value="poussin">Poussin</option>
                        <option value="caille">Caille</option>
                        <option value="pigeon">Pigeon</option>
                        <option value="lapin">Lapin</option>
                        <option value="lievre">Li√®vre</option>
                        <option value="canard">Canard</option>
                        <option value="faisan">Faisan</option>
                        <option value="perdrix">Perdrix</option>
                        <option value="boeuf">B≈ìuf</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quantite-nourriture">Quantit√© :</label>
                    <input type="text" id="quantite-nourriture" placeholder="Ex: 200g">
                </div>
            </div>
        </div>

        <!-- Autres champs conditionnels... (conserv√©s du code original) -->
        <div id="vol-fields" class="conditional-fields">
            <div class="form-group">
                <label for="type-vol">Type de vol :</label>
                <select id="type-vol">
                    <option value="suite">Suit√©</option>
                    <option value="chasse">Chasse</option>
                    <option value="entrainement">Entra√Ænement</option>
                </select>
            </div>
        </div>

        <div id="comportement-fields" class="conditional-fields">
            <div class="form-group">
                <label>R√©activit√© (1-5) :</label>
                <div class="rating-group">
                    <input type="radio" id="react1" name="reactivite" value="1">
                    <label for="react1">1</label>
                    <input type="radio" id="react2" name="reactivite" value="2">
                    <label for="react2">2</label>
                    <input type="radio" id="react3" name="reactivite" value="3">
                    <label for="react3">3</label>
                    <input type="radio" id="react4" name="reactivite" value="4">
                    <label for="react4">4</label>
                    <input type="radio" id="react5" name="reactivite" value="5">
                    <label for="react5">5</label>
                </div>
            </div>
        </div>

        <div id="sante-fields" class="conditional-fields">
            <div class="form-group">
                <label for="etat-sante">√âtat :</label>
                <select id="etat-sante">
                    <option value="ras">RAS</option>
                    <option value="pb">PB</option>
                </select>
            </div>
        </div>

        <div id="entrainement-fields" class="conditional-fields">
            <div class="form-group">
                <label for="type-entrainement">Type d'entra√Ænement :</label>
                <select id="type-entrainement">
                    <option value="filiere">Fili√®re</option>
                    <option value="charriot">Charriot</option>
                    <option value="rc-voiture">RC Voiture</option>
                    <option value="drone">Drone</option>
                    <option value="vivant">Vivant</option>
                    <option value="corde">Corde</option>
                    <option value="ascendant">Ascendant</option>
                </select>
            </div>
        </div>

        <button onclick="addEntry()">Ajouter l'Entr√©e</button>

        <h2 style="margin-top: 40px;">Historique R√©cent</h2>
        <div id="entry-list"></div>
    </div>

    <div id="chasse" class="tab-content">
        <h2>Registre de Chasse</h2>
        <div class="form-group">
            <label for="chasse-rapace">Rapace :</label>
            <select id="chasse-rapace">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="chasse-date">Date :</label>
                <input type="date" id="chasse-date">
            </div>
            <div class="form-group">
                <label for="chasse-time">Heure :</label>
                <input type="time" id="chasse-time">
            </div>
        </div>
        
        <div class="hunt-grid">
            <div class="hunt-item">
                <label for="chasse-faisan">Faisan :</label>
                <input type="number" id="chasse-faisan" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-perdrix">Perdrix :</label>
                <input type="number" id="chasse-perdrix" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-lapin">Lapin :</label>
                <input type="number" id="chasse-lapin" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-lievre">Li√®vre :</label>
                <input type="number" id="chasse-lievre" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-canard">Canard :</label>
                <input type="number" id="chasse-canard" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-oie">Oie :</label>
                <input type="number" id="chasse-oie" min="0" max="10" value="0">
            </div>
            <div class="hunt-item">
                <label for="chasse-autre">Autre :</label>
                <input type="number" id="chasse-autre" min="0" max="10" value="0">
            </div>
        </div>
        
        <div class="form-group">
            <label for="chasse-notes">Notes :</label>
            <textarea id="chasse-notes" rows="3" placeholder="Observations sur la chasse..."></textarea>
        </div>
        
        <button onclick="addChasse()">Enregistrer la Chasse</button>
        
        <h2 style="margin-top: 40px;">Historique des Chasses</h2>
        <div id="chasse-list"></div>
    </div>

    <div id="affaitage" class="tab-content">
        <h2>Affaitage</h2>
        <div class="form-group">
            <label for="affaitage-rapace">Rapace :</label>
            <select id="affaitage-rapace">
                <option value="">Choisir un rapace</option>
            </select>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="affaitage-date">Date :</label>
                <input type="date" id="affaitage-date">
            </div>
            <div class="form-group">
                <label for="affaitage-time">Heure :</label>
                <input type="time" id="affaitage-time">
            </div>
        </div>
        
        <div class="form-group">
            <label>Activit√©s :</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="prise-nourriture">
                    <label for="prise-nourriture">Prise de nourriture</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="gant">
                    <label for="gant">Gant</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filiere">
                    <label for="filiere">Fili√®re</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="libre">
                    <label for="libre">Libre</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="affaitage-notes">Notes :</label>
            <textarea id="affaitage-notes" rows="3" placeholder="Observations sur l'affaitage..."></textarea>
        </div>
        
        <button onclick="addAffaitage()">Enregistrer l'Affaitage</button>
        
        <h2 style="margin-top: 40px;">Historique d'Affaitage</h2>
        <div id="affaitage-list"></div>
    </div>

    <div id="stats" class="tab-content">
        <h2>Statistiques</h2>
        <div style="margin-bottom: 20px;">
            <div class="day-navigation">
                <button onclick="changeStatsDate(-1)">‚Üê Jour pr√©c√©dent</button>
                <input type="date" id="stats-date" onchange="updateStats()">
                <button onclick="changeStatsDate(1)">Jour suivant ‚Üí</button>
                <button onclick="showMultipleDays()">Voir 4 jours</button>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="exportAllData()">üíæ Exporter</button>
                <button onclick="importAllData()" style="margin-left: 10px;">üìÅ Importer</button>
                <button onclick="clearAllData()" class="btn-danger" style="margin-left: 10px;">üóëÔ∏è Vider</button>
            </div>
        </div>
        <div id="stats-content"></div>
    </div>

    <div id="sync" class="tab-content">
        <h2>üåê Synchronisation Google Drive</h2>
        
        <div id="sync-status-container" class="sync-status disconnected">
            <h4 id="sync-status">üìä √âtat de la synchronisation</h4>
            <p id="sync-details">üîÑ Pr√™t √† se connecter</p>
            <p id="last-sync-time">Derni√®re sync : Jamais</p>
        </div>

        <div style="margin: 20px 0;">
            <h3>üîß Configuration</h3>
            <div style="display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap;">
                <button onclick="initGoogleDriveSync()" id="connect-drive-btn">üîó Connecter Google Drive</button>
                <button onclick="manualSync()" id="manual-sync-btn" style="display: none;">‚ö° Synchroniser maintenant</button>
                <button onclick="disconnectDrive()" id="disconnect-drive-btn" style="display: none;" class="btn-secondary">‚ùå D√©connecter</button>
            </div>
            <p style="font-size: 14px; color: #666;">
                Cliquez sur "Connecter Google Drive" et autorisez l